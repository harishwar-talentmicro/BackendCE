/**
 * Controller to manage Ezeone actions
 *
 * @author: Sandeep[EZE ID]
 * @since 20150526
 */
angular.module('ezeidApp').
    controller('OutboxPageJoinEzeoneCtrl', [
        '$rootScope',
        '$scope',
        '$http',
        '$q',
        '$timeout',
        'Notification',
        '$filter',
        '$window',
        'GURL',
        '$interval',
        'MsgDelay',
        '$location',
        '$routeParams',
        'UtilityService',
        function (
            $rootScope,
            $scope,
            $http,
            $q,
            $timeout,
            Notification,
            $filter,
            $window,
            GURL,
            $interval,
            MsgDelay,
            $location,
            $routeParams,
            UtilityService
        ) {

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////INITIALIZATIONS/////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////

            /* modalbox */
            $scope.modalAddEzeoneVisible = false;

            /* detail modal goes here */
            $scope.ezeOneModalBox = {
                title : 'Connect',
                class : 'business-manager-modal',
                groupDesc : '',
                ezeone:''

            };
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////Default Functions///////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////ACTION//////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////

            /**
             * Toggle visibility of the modal box for joinig request/response
             */
            $scope.toggleEzeoneModalVisibility = function()
            {
                $scope.modalAddEzeoneVisible = !$scope.modalAddEzeoneVisible;
            }

            /**
             * check if the ezeOneValidationStatus have changed its value
             * & Validate EzeoneId API call response
             */
            $scope.$watch('ezeOneValidationStatus',function(){
                /* append @ if it is not there */
                var keyword = $scope.ezeOneModalBox.ezeone;
                var ezeone = parseInt(getGroupNameType(keyword)) ==  0?"@"+keyword:keyword;
                $scope.ezeOneModalBox.ezeone = ezeone;
                /* take suitable action */
                console.log($scope.ezeOneValidationStatus);
            });

            /**
             * Get the group type
             * 0: group
             * 1: EZEOne ID
             */
            function getGroupNameType(groupName)
            {
                if(!groupName)
                {
                    return;
                }
                var grp = groupName.toString();
                var grpArr = grp.split("");
                if(grpArr[0] == '@')
                {
                    return 1;
                }
                else
                {
                    return 0;
                }
            }
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////EZEONE: JOIN  REQUEST///////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////

            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////EZEONE: JOIN  RESPONSE///////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////
            ////////////////////////////////////////////////////////////////////////////////////////////////////////////

        }
    ]);